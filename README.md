# 茶楼管理系统

一个轻量化的茶楼管理系统，支持房间管理、商品销售、财务管理、用户权限管理等核心功能。

## 功能特性

### 🔐 用户登录系统
- **权限管理**：管理员和操作员两种角色
- **登录验证**：用户名密码认证，支持回车键登录
- **会话保持**：自动记住登录状态
- **操作记录**：所有交易记录包含操作员信息
- **默认账户**：admin / xj123456

### 🏠 房间管理
- **包房管理**：大雅01、大雅02，小雅801-803，805-809（无804）
- **大厅管理**：大厅1-10
- **房间状态**：空闲、使用中、预留三种模式 
- **计费系统**：4小时一场，支持向上/向下取整
- **⏯️ 暂停计时**：支持暂停和恢复计时功能
- **实时显示**：总时长、暂停时长、实际使用时长
- **智能计费**：基于实际使用时长计算费用

### 🛒 商品管理
- **商品销售**：选择商品和数量
- **库存管理**：实时更新库存状态
- **价格管理**：动态调整商品价格
- **购物车功能**：支持添加、删除商品

### 💰 财务管理
- **借贷功能**：支持借钱和还钱操作
- **多种支付**：现金、微信、支付宝
- **自动结算**：房费+商品费+借款综合计算
- **实时统计**：各项费用实时更新

### ⚙️ 后台管理
- **费率设置**：
  - 大厅统一费率
  - 包房独立费率（使用中时不可修改）
  - 空调、烤火费率
- **商品管理**：
  - 添加新商品
  - 修改价格和库存
  - 删除商品
- **👥 用户管理**（仅管理员）：
  - 添加操作员账户
  - 重置用户密码
  - 删除用户（除管理员外）
  - 角色权限控制

### 📊 报表系统
- **每日明细**：房间消费、商品消费分类统计
- **操作员筛选**：可按操作员查看报表
- **详细记录**：包含暂停时长、实际时长等详细信息
- **收入统计**：房费、商品费、借款等综合统计
- **数据管理**：支持清空历史记录（仅管理员）

## 新增功能 ✨

### 1. 暂停计时功能
- 房间使用过程中可随时暂停计时
- 自动记录暂停时长
- 基于实际使用时长计费
- 暂停状态明显提示

### 2. 登录系统
- 用户名密码登录验证
- 管理员和操作员权限区分
- 所有操作记录操作员信息
- 安全的会话管理

### 3. 用户管理
- 管理员可添加/删除操作员
- 密码重置功能
- 用户角色标识
- 权限控制界面元素

## 权限说明

### 管理员权限
- ✅ 所有房间管理功能
- ✅ 商品销售功能
- ✅ 费率设置
- ✅ 商品管理
- ✅ 用户管理
- ✅ 报表查看和数据清空

### 操作员权限
- ✅ 房间管理功能
- ✅ 商品销售功能
- ✅ 基本报表查看
- ❌ 费率设置
- ❌ 用户管理
- ❌ 数据清空

## 技术特点

- **纯前端实现**：HTML + CSS + JavaScript
- **本地存储**：使用localStorage持久化数据
- **响应式设计**：支持桌面和移动设备
- **轻量化代码**：简洁高效的实现方案
- **权限控制**：基于角色的功能访问控制

## 使用说明

### 首次使用
1. 打开 `index.html` 文件
2. 使用默认管理员账户登录：admin / xj123456
3. 在用户管理中添加操作员账户
4. 设置房间费率和商品信息

### 日常操作
1. 操作员登录系统
2. 选择房间进入管理界面
3. 进行开房、暂停/恢复、商品销售、借贷等操作
4. 结账时自动生成交易记录（含操作员信息）
5. 查看每日明细了解经营情况

### 管理功能
1. 管理员可通过后台管理调整费率和商品
2. 在用户管理中管理操作员账户
3. 查看详细报表，支持按操作员筛选

## 数据结构

### 房间数据（扩展）
```javascript
rooms = {
  '房间名': {
    status: 'idle|occupied|reserved',
    startTime: timestamp,
    products: [商品列表],
    loans: 借款金额,
    totalFee: 总费用,
    pausedTime: 暂停总时长,
    pauseStart: 暂停开始时间,
    isPaused: 是否暂停中
  }
}
```

### 用户数据
```javascript
users = {
  '用户名': {
    password: '密码',
    role: 'admin|operator',
    name: '真实姓名'
  }
}
```

### 交易记录（扩展）
```javascript
transactions = [{
  date: '日期',
  time: '时间',
  operator: '操作员姓名',
  room: '房间',
  roomFee: 房费,
  products: [商品明细],
  productFee: 商品费,
  loans: 借款,
  total: 总计,
  duration: '总时长',
  actualDuration: '实际时长',
  pausedDuration: '暂停时长'
}]
```

## 浏览器兼容性

- Chrome/Edge 80+
- Firefox 75+
- Safari 13+
- 移动端浏览器

## 部署方法

将所有文件放在Web服务器目录下，或直接双击 `index.html` 在浏览器中打开。

## 安全建议

1. **修改默认密码**：首次使用后立即修改管理员密码
2. **定期备份数据**：重要数据请定期导出备份
3. **权限控制**：合理分配操作员权限，避免误操作
4. **密码管理**：为操作员设置强密码

## 更新日志

### v2.0.0 (2025-01-19)
- ✨ 新增登录系统和用户管理
- ✨ 新增房间暂停计时功能
- ✨ 报表支持按操作员筛选
- 🔒 新增权限控制机制
- 📝 交易记录包含操作员信息
- 🎨 优化用户界面和交互体验

### v1.0.0 (2025-01-19)
- 🎉 基础茶楼管理系统
- 🏠 房间管理功能
- 🛒 商品销售功能
- 💰 借贷管理功能
- 📊 报表统计功能

## 打包为 Windows 桌面应用（EXE）

项目已集成 Electron + electron-builder 打包配置，可在 Windows 10/11 上稳定运行为 EXE。

### 一、环境准备（在 Windows 上执行）
- 安装 Node.js LTS（建议 18.x/20.x）：https://nodejs.org/
- 可选：安装 Git 与 VSCode
- 克隆或复制本项目到本地目录（确保包含 package.json 与 electron/main.js）

### 二、安装依赖
在项目根目录执行：
```bash
npm install
```

### 三、本地桌面预览（Electron）
```bash
npm start
```
启动后会打开一个桌面窗口加载本地 `index.html`，数据依旧使用浏览器的 localStorage（Electron 的 Chromium Profile）。

### 四、生成 Windows 安装包（EXE）
```bash
npm run dist:win
```
打包输出目录：`dist/`  
产物示例：`TeaHouse_1.0.0_x64.exe`（具体名称依 `arch` 而定）

> 说明：
> - 请在 Windows 系统上执行打包命令。macOS/Linux 打包 Windows 安装包需要额外安装 wine/mono，且兼容性不如在 Windows 上直接打包稳定。
> - 首次运行 EXE 时，Windows 可能提示“Windows 已保护您的电脑”或 SmartScreen 警告（未签名）。点击“更多信息”->“仍要运行”，或在文件属性中勾选“解除锁定”。

### 五、运行与数据位置
- 安装后，开始菜单/桌面会出现“茶楼管理系统”（productName）。
- 应用数据（包括 localStorage）默认在：
  ```
  C:\Users\%USERNAME%\AppData\Roaming\茶楼管理系统\
  ```
  这是 Electron 的用户数据目录（`app.getPath('userData')`），用于存储本地配置与数据缓存。

### 六、自定义图标（可选）
如需自定义 Windows 安装图标：
1. 准备 `build/win/icon.ico`
2. 在 `package.json` 的 `build.win` 中配置：
   ```json
   "win": {
     "target": ["nsis"],
     "icon": "build/win/icon.ico",
     "artifactName": "TeaHouse_${version}_${arch}.${ext}"
   }
   ```
3. 重新运行 `npm run dist:win`

### 七、常见问题
- 打包时报杀软误报：请将项目目录与 `dist/` 加入杀软白名单或暂时关闭再尝试。
- 安装后空白页：请确认 `index.html / style.css / script.js` 被包含在打包产物中（已在 `package.json` 的 `build.files` 中配置），并且无路径大小写问题。
- 需要离线运行：本应用为纯本地静态资源，不依赖网络，可完全离线运行。

## 许可证

MIT License
